<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FarmSuite Worker Dashboard</title>
  <link rel="icon" type="image/png" href="imgs/logo1.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="worker-dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>


 <!-- Navbar -->
<nav class="navbar">
  <div class="navbar-brand">
    <i class="fas fa-tractor"></i>
    <span>FarmSuite.</span>
  </div>
  <div class="navbar-links">
    <a href="#tasks">Tasks</a>
    <a href="#livestock">Livestock</a>
    <a href="#abnormal-milk">Abnormal Milk</a>
    <a href="#breeding-cycles">Breeding Cycles</a>
    <a href="#health-alerts">Health Alerts</a>
    <a href="#inventory">Inventory</a>
    <a href="#communication">Communication</a>
    <!-- Logout Button -->
    <a href="#" onclick="confirmLogout()" class="logout-button">
      <i class="fas fa-sign-out-alt"></i> Logout
    </a>
  </div>
</nav>

  <!-- Dashboard Content -->
  <div class="dashboard">


<!-- Worker Dashboard Banner -->
<section class="dashboard-banner">
  <div class="banner-content">
    <i class="fa-solid fa-seedling"></i>
    <h1>Worker Dashboard</h1>
    <p>Efficiently manage tasks, monitor livestock, and stay updated with real-time insights.</p>
  </div>
</section>


    <!-- Task List & Status Updates -->
<!-- Task List & Status Updates -->
<section id="tasks" class="section task-list">
  <h2><i class="fas fa-tasks"></i> Task List</h2>
  <div class="task-container">
      <div class="task-list-container">
          <ul id="task-list">
              <!-- Tasks will be dynamically added here -->
              <li>Loading tasks...</li>
          </ul>
      </div>
      <div class="chart-container">
          <canvas id="taskChart"></canvas>
      </div>
  </div>
</section>

    <!-- Livestock & Production Monitoring -->
<section id="livestock" class="section livestock-monitoring">
  <h2><i class="fas fa-cow"></i> Livestock Monitoring</h2>
  <div class="livestock-container">
    <!-- Milk Production Section -->
    <div class="form-and-table-container">
      <div class="livestock-form">
        <h3><i class="fas fa-weight"></i> Milk Production</h3>
        <div class="form-group">
          <label for="cow-id"><i class="fas fa-tag"></i> Cow ID:</label>
          <input type="text" id="cow-id" placeholder="Enter Cow ID" oninput="validateCowId(this)">
          <div class="error-message" id="cow-id-error">Cow ID must be a number</div>        
        </div>
        <div class="form-group">
          <label for="milk-production"><i class="fas fa-weight"></i> Milk Production (Liters):</label>
          <input type="text" id="milk-production" placeholder="Enter milk production" oninput="validateMilkProduction(this)">
          <div class="error-message" id="milk-production-error">Must be a number (e.g., 5.2)</div>
        </div>
        <button onclick="recordMilkProduction()"><i class="fas fa-save"></i> Record</button>
      </div>
      <div class="milk-production-table">
        <h3><i class="fas fa-table"></i> Milk Production Records</h3>
        <table>
          <thead>
            <tr>
              <th>Cow ID</th>
              <th>Milk Production (Liters)</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="milk-records">
            <!-- Records will be dynamically added here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Feed Consumption Section -->
    <div class="form-and-table-container">
      <div class="livestock-form">
        <h3><i class="fas fa-utensils"></i> Feed Consumption</h3>
        <div class="form-group">
          <label for="feed-cow-id"><i class="fas fa-tag"></i> Cow ID:</label>
          <input type="text" id="feed-cow-id" placeholder="Enter Cow ID" oninput="validateCowId(this)">
      <div class="error-message" id="feed-cow-id-error">Cow ID must be a number</div>
        </div>
        <div class="form-group">
          <label for="feed-amount"><i class="fas fa-weight"></i> Feed Amount (kg):</label>
          <input type="text" id="feed-amount" placeholder="Enter feed amount" oninput="validateFeedAmount(this)">
      <div class="error-message" id="feed-amount-error">Must be a number (e.g., 10.5)</div>
        </div>
        <button onclick="recordFeedConsumption()"><i class="fas fa-save"></i> Record</button>
      </div>
      <div class="feed-consumption-table">
        <h3><i class="fas fa-utensils"></i> Feed Consumption Records</h3>
        <table>
          <thead>
            <tr>
              <th>Cow ID</th>
              <th>Feed Amount (kg)</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="feed-records">
            <!-- Records will be dynamically added here -->
          </tbody>
        </table>
      </div>
    </div>

     <!-- Medication Administration Section -->
     <div class="form-and-table-container">
      <div class="livestock-form">
        <h3><i class="fas fa-pills"></i> Medication Administration</h3>
        <div class="form-group">
          <label for="med-cow-id"><i class="fas fa-tag"></i> Cow ID:</label>
          <input type="text" id="med-cow-id" placeholder="Enter Cow ID" oninput="validateCowId(this)">
          <div class="error-message" id="med-cow-id-error">Cow ID must be a number</div>
        </div>
        <div class="form-group">
          <label for="medication"><i class="fas fa-prescription-bottle"></i> Medication:</label>
          <input type="text" id="medication" placeholder="Enter medication" oninput="validateMedication(this)">
      <div class="error-message" id="medication-error">No special characters allowed</div>
        </div>
        <div class="form-group">
          <label for="dosage"><i class="fas fa-syringe"></i> Dosage:</label>
          <input type="text" id="dosage" placeholder="Enter dosage (e.g., 2 ml)" oninput="validateDosage(this)">
      <div class="error-message" id="dosage-error">Format: number and unit (e.g., 2 ml)</div>
        </div>
        <button onclick="recordMedication()"><i class="fas fa-save"></i> Record</button>
      </div>
      <div class="medication-table">
        <h3><i class="fas fa-pills"></i> Medication Records</h3>
        <table>
          <thead>
            <tr>
              <th>Cow ID</th>
              <th>Medication</th>
              <th>Dosage</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody id="medication-records">
            <!-- Records will be dynamically added here -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>




<!-- Abnormal Milk Production Tracking -->
<section id="abnormal-milk" class="section abnormal-milk">
  <h2><i class="fas fa-chart-line"></i> Track Abnormal Milk Production</h2>
  <div class="abnormal-milk-container">
    <!-- Form to input Cow ID and date range -->
    <div class="abnormal-milk-form">
      <div class="form-group">
        <label for="abnormal-cow-id"><i class="fas fa-tag"></i> Enter Cow ID:</label>
        <input type="text" id="med-cow-id" placeholder="Enter Cow ID" oninput="validateCowId(this)">
        <div class="error-message" id="med-cow-id-error">Cow ID must be a number</div>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="from-date"><i class="fas fa-calendar"></i> From:</label>
          <input type="date" id="from-date">
        </div>
        <div class="form-group">
          <label for="to-date"><i class="fas fa-calendar"></i> To:</label>
          <input type="date" id="to-date">
        </div>
      </div>
      <button onclick="fetchAndPlotMilkProduction()"><i class="fas fa-chart-line"></i> Plot Milk Production</button>
    </div>

    <!-- Chart Container -->
    <div class="abnormal-milk-chart">
      <canvas id="abnormalMilkChart"></canvas>
    </div>
  </div>
</section>



<!-- Breeding Cycles Monitoring -->
<div class="breeding-cycles">
  <h3><i class="fas fa-calendar-alt"></i> Track Breeding Cycles</h3>
  <div class="breeding-container">
    <!-- Form on the left -->
    <div class="breeding-form">
      <div class="form-group">
        <label for="cow-id-breeding"><i class="fas fa-tag"></i> Cow ID:</label>
        <input type="text" id="med-cow-id" placeholder="Enter Cow ID" oninput="validateCowId(this)">
        <div class="error-message" id="med-cow-id-error">Cow ID must be a number</div>
      </div>
      <div class="form-group">
        <label for="breeding-date"><i class="fas fa-calendar"></i> Breeding Date:</label>
        <input type="date" id="breeding-date">
      </div>
      <div class="form-group">
        <label for="expected-calving-date"><i class="fas fa-calendar-check"></i> Expected Calving Date:</label>
        <input type="date" id="expected-calving-date">
      </div>
      <button onclick="recordBreedingCycle()"><i class="fas fa-save"></i> Record</button>
    </div>

    <!-- Chart on the right -->
    <div class="breeding-chart">
      <canvas id="breedingChart"></canvas>
    </div>
  </div>
</div>
    </section>



<!-- Health Alerts and Reports -->
<section id="health-alerts" class="section health-alerts">
  <h2><i class="fas fa-heartbeat"></i> Report Health Concern</h2>
  <div class="health-alerts-container">
    <!-- Health Concern Form -->
    <div class="health-concern-form">
      <div class="form-group">
        <label for="health-cow-id"><i class="fas fa-tag"></i> Cow ID:</label>
        <input type="text" id="health-cow-id" placeholder="Enter Cow ID" required oninput="validateCowId(this)">
        <div class="error-message" id="health-cow-id-error">Cow ID must be a number</div>
      </div>
      <div class="form-group">
        <label for="health-concern"><i class="fas fa-exclamation-triangle"></i> Health Concern:</label>
        <textarea id="health-concern" placeholder="Describe the health concern..." rows="4" required oninput="validateHealthConcern(this)"></textarea>
      <div class="error-message" id="health-concern-error">No special characters allowed</div>
      </div>
      <button onclick="reportHealthConcern()"><i class="fas fa-bell"></i> Report Concern</button>
    </div>

    <!-- Health Alerts List -->
    <div class="health-alerts-list">
      <h3><i class="fas fa-bell"></i> Recent Health Alerts</h3>
      <ul id="health-alerts-list">
        <!-- Alerts will be dynamically added here -->
      </ul>
    </div>
  </div>
</section>    



    <!-- Inventory & Supplies -->
<section id="inventory" class="section inventory">
  <h2><i class="fas fa-boxes"></i> Inventory</h2>
  <div class="inventory-container">
    <!-- Fodder Progress Bar -->
    <div class="inventory-item">
      <div class="inventory-header">
        <i class="fas fa-haykal"></i>
        <span>Fodder</span>
      </div>
      <div class="progress-bar">
        <div class="progress" id="fodder-progress" style="width: 60%;"></div>
      </div>
      <p class="inventory-count"><span id="fodder-count">60</span> kg available</p>
      <button onclick="openFodderModal()"><i class="fas fa-cart-plus"></i> Request Fodder Refill</button>    
    </div>

    <!-- Medicine Progress Bar -->
    <div class="inventory-item">
      <div class="inventory-header">
        <i class="fas fa-pills"></i>
        <span>Medicine</span>
      </div>
      <div class="progress-bar">
        <div class="progress" id="medicine-progress" style="width: 30%;"></div>
      </div>
      <p class="inventory-count"><span id="medicine-count">30</span> units available</p>
      <button onclick="requestRefill('medicine')"><i class="fas fa-cart-plus"></i> Request Medicine Refill</button>
    </div>
  </div>
</section>

    <!-- In worker-dashboard.html, update the communication section -->
<section id="communication" class="section communication">
  <h2><i class="fas fa-comments"></i> Communication</h2>
  <div class="communication-container">
    <!-- Message Input -->
    <div class="message-input">
      <div class="form-group">
        <label for="message-subject"><i class="fas fa-heading"></i> Subject:</label>
        <input type="text" id="message-subject" placeholder="Message subject">
      </div>
      <div class="form-group">
        <label for="message"><i class="fas fa-envelope"></i> Message:</label>
        <textarea id="message" placeholder="Type your message..." rows="4" required></textarea>
      </div>
      <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i> Send to Manager</button>
    </div>

    <!-- Message Inbox -->
    <div class="message-inbox">
      <div class="inbox-tabs">
        <button class="tab-button active" onclick="showMessages('inbox')">
          <i class="fas fa-inbox"></i> Inbox
          <span class="unread-count" id="inbox-count">0</span>
        </button>
        <button class="tab-button" onclick="showMessages('sent')">
          <i class="fas fa-paper-plane"></i> Sent
        </button>
      </div>
      
      <div class="messages-container">
        <!-- Inbox Messages -->
        <div class="message-list" id="inbox-messages">
          <!-- Messages from manager will appear here -->
        </div>
        
        <!-- Sent Messages -->
        <div class="message-list" id="sent-messages" style="display:none;">
          <!-- Sent messages will appear here -->
        </div>
      </div>
    </div>
  </div>
</section>


<!-- Fodder Refill Modal -->
<div class="modal" id="fodder-refill-modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeFodderModal()">&times;</span>
    
    <!-- Modal Header -->
    <div class="modal-header">
      <div class="header-icon">
        <i class="fas fa-haykal"></i>
      </div>
      <div class="header-text">
        <h3>Fodder Refill Request</h3>
        <p>Please fill out the details for your fodder order</p>
      </div>
    </div>
    
    <!-- Form Content -->
    <form id="fodder-refill-form">
      <div class="form-group">
        <label for="fodder-type"><i class="fas fa-cubes"></i> Fodder Type</label>
        <select id="fodder-type" required>
          <option value="">Select fodder type</option>
          <option value="premium">Premium Blend</option>
          <option value="standard">Standard Mix</option>
          <option value="organic">Organic Fodder</option>
          <option value="custom">Custom Mix</option>
        </select>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="fodder-quantity"><i class="fas fa-weight-hanging"></i> Quantity (kg)</label>
          <input type="number" id="fodder-quantity" min="10" max="1000" required>
        </div>
        <div class="form-group">
          <label for="fodder-urgency"><i class="fas fa-clock"></i> Urgency</label>
          <select id="fodder-urgency" required>
            <option value="normal">Normal (3-5 days)</option>
            <option value="urgent">Urgent (1-2 days)</option>
            <option value="emergency">Emergency (same day)</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label for="fodder-notes"><i class="fas fa-edit"></i> Special Instructions</label>
        <textarea id="fodder-notes" rows="3" placeholder="Any special requirements or notes..."></textarea>
      </div>
      
      <div class="form-footer">
        <button type="button" class="btn-cancel" onclick="closeFodderModal()">
          <i class="fas fa-times"></i> Cancel
        </button>
        <button type="submit" class="btn-submit">
          <i class="fas fa-paper-plane"></i> Submit Request
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Success Popup -->
<div id="fodder-success-popup" class="success-popup">
  <div class="popup-content">
    <div class="popup-icon">
      <i class="fas fa-check-circle"></i>
    </div>
    <h3>Request Submitted!</h3>
    <p>Your fodder refill request has been received and will be processed shortly.</p>
    <button class="popup-close-btn" onclick="closeSuccessPopup()">OK</button>
  </div>
</div>



<!-- Scroll to Top Button -->
<button id="scrollToTopBtn" class="scroll-to-top">
  <i class="fas fa-arrow-up"></i>
</button>

  <!-- JavaScript at the bottom of the file -->
  <script>
    
    // Task Status Data
    let taskStatus = {
      assigned: 3,
      pending: 0,
      completed: 0,
      notDone: 0
    };

    // Initialize Chart
    const ctx = document.getElementById('taskChart').getContext('2d');
    const taskChart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Assigned', 'Pending', 'Completed', 'Not Done'],
        datasets: [{
          label: 'Task Status',
          data: [taskStatus.assigned, taskStatus.pending, taskStatus.completed, taskStatus.notDone],
          backgroundColor: [
            '#007bff',
            '#ffc107',
            '#28a745',
            '#dc3545'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });





    // Update Chart Data
    function updateChart() {
      taskChart.data.datasets[0].data = [
        taskStatus.assigned,
        taskStatus.pending,
        taskStatus.completed,
        taskStatus.notDone
      ];
      taskChart.update();
    }

    // Report Issue
    function reportIssue() {
      const issue = prompt("Describe the issue:");
      if (issue) {
        addNotification(`Issue reported: ${issue}`);
      }
    }'/'


    // -------------------------------------- Milk Production Records Data
let milkProductionRecords = [];

// Record Milk Production
function recordMilkProduction() {
  const cowIdValid = validateCowId(document.getElementById('cow-id'));
      const milkProductionValid = validateMilkProduction(document.getElementById('milk-production'));
      
      if (!cowIdValid || !milkProductionValid) {
        return;
      }

      const cowId = document.getElementById('cow-id').value.trim();
      const milkProduction = document.getElementById('milk-production').value.trim();
  // Create a new record
  const record = {
    cowId: cowId,
    milkProduction: milkProduction,
    date: new Date().toLocaleDateString()
  };

  // Add to records array
  milkProductionRecords.push(record);

  // Update the table
  updateMilkProductionTable();

  // Clear the form
  document.getElementById('cow-id').value = "";
  document.getElementById('milk-production').value = "";

  // Add notification
  addNotification(`Milk production recorded for Cow ID: ${cowId}`);
}

// Update Milk Production Table
function updateMilkProductionTable() {
  const tableBody = document.getElementById('milk-records');
  tableBody.innerHTML = ""; // Clear existing rows

  // Add each record as a new row
  milkProductionRecords.forEach(record => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${record.cowId}</td>
      <td>${record.milkProduction}</td>
      <td>${record.date}</td>
    `;
    tableBody.appendChild(row);
  });
}


// Modify the recordMilkProduction function to save to localStorage
function recordMilkProduction() {
  const cowId = document.getElementById('cow-id').value;
  const milkProduction = document.getElementById('milk-production').value;

  if (!cowId || !milkProduction) {
    alert("Please enter Cow ID and Milk Production.");
    return;
  }

  // Create a new record
  const record = {
    cowId: cowId,
    milkProduction: milkProduction,
    date: new Date().toLocaleDateString()
  };

  // Get existing records from localStorage or initialize empty array
  let records = JSON.parse(localStorage.getItem('milkProductionRecords') || '[]');
  
  // Add new record
  records.push(record);
  
  // Save back to localStorage
  localStorage.setItem('milkProductionRecords', JSON.stringify(records));
  
  // Update the table
  milkProductionRecords = records;
  updateMilkProductionTable();

  // Clear the form
  document.getElementById('cow-id').value = "";
  document.getElementById('milk-production').value = "";

  // Add notification
  addNotification(`Milk production recorded for Cow ID: ${cowId}`);
}

// Load records from localStorage when page loads
document.addEventListener('DOMContentLoaded', function() {
  milkProductionRecords = JSON.parse(localStorage.getItem('milkProductionRecords') || []);
  updateMilkProductionTable();
});



    // -------------------------------------- Feed consumption Records Data
let feedConsumptionRecords = [];

// Record Feed Consumption
function recordFeedConsumption() {
  const cowIdValid = validateCowId(document.getElementById('feed-cow-id'));
      const feedAmountValid = validateFeedAmount(document.getElementById('feed-amount'));
      
      if (!cowIdValid || !feedAmountValid) {
        return;
      }

      const cowId = document.getElementById('feed-cow-id').value.trim();
      const feedAmount = document.getElementById('feed-amount').value.trim();

  // Create a new record
  const record = {
    cowId: cowId,
    feedAmount: feedAmount,
    date: new Date().toLocaleDateString()
  };

  // Add to records array
  feedConsumptionRecords.push(record);

  // Update the table
  updateFeedConsumptionTable();

  // Clear the form
  document.getElementById('feed-cow-id').value = "";
  document.getElementById('feed-amount').value = "";

  // Add notification
  addNotification(`Feed consumption recorded for Cow ID: ${cowId}`);
}

// Update Feed Consumption Table
function updateFeedConsumptionTable() {
  const tableBody = document.getElementById('feed-records');
  tableBody.innerHTML = ""; // Clear existing rows

  // Add each record as a new row
  feedConsumptionRecords.forEach(record => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${record.cowId}</td>
      <td>${record.feedAmount}</td>
      <td>${record.date}</td>
    `;
    tableBody.appendChild(row);
  });
}

// Record Feed Consumption with localStorage
function recordFeedConsumption() {
  const cowId = document.getElementById('feed-cow-id').value;
  const feedAmount = document.getElementById('feed-amount').value;

  if (!cowId || !feedAmount) {
    alert("Please enter Cow ID and Feed Amount.");
    return;
  }

  // Create a new record
  const record = {
    cowId: cowId,
    feedAmount: feedAmount,
    date: new Date().toLocaleDateString()
  };

  // Get existing records from localStorage or initialize empty array
  let records = JSON.parse(localStorage.getItem('feedConsumptionRecords') || '[]');
  
  // Add new record
  records.push(record);
  
  // Save back to localStorage
  localStorage.setItem('feedConsumptionRecords', JSON.stringify(records));
  
  // Update the table
  feedConsumptionRecords = records;
  updateFeedConsumptionTable();

  // Clear the form
  document.getElementById('feed-cow-id').value = "";
  document.getElementById('feed-amount').value = "";

  // Add notification
  addNotification(`Feed consumption recorded for Cow ID: ${cowId}`);
}

// Load records from localStorage when page loads
document.addEventListener('DOMContentLoaded', function() {
  feedConsumptionRecords = JSON.parse(localStorage.getItem('feedConsumptionRecords') || []);
  updateFeedConsumptionTable();
});



//-----------------------------------------  Medication Records Data
let medicationRecords = [];

// Record Medication
function recordMedication() {
  const cowIdValid = validateCowId(document.getElementById('med-cow-id'));
      const medicationValid = validateMedication(document.getElementById('medication'));
      const dosageValid = validateDosage(document.getElementById('dosage'));
      
      if (!cowIdValid || !medicationValid || !dosageValid) {
        return;
      }

      const cowId = document.getElementById('med-cow-id').value.trim();
      const medication = document.getElementById('medication').value.trim();
      const dosage = document.getElementById('dosage').value.trim();


  // Create a new record
  const record = {
    cowId: cowId,
    medication: medication,
    dosage: dosage,
    date: new Date().toLocaleDateString()
  };

  // Add to records array
  medicationRecords.push(record);

  // Update the table
  updateMedicationTable();

  // Clear the form
  document.getElementById('med-cow-id').value = "";
  document.getElementById('medication').value = "";
  document.getElementById('dosage').value = "";

  // Add notification
  addNotification(`Medication recorded for Cow ID: ${cowId}`);
}

// Update Medication Table
function updateMedicationTable() {
  const tableBody = document.getElementById('medication-records');
  tableBody.innerHTML = ""; // Clear existing rows

  // Add each record as a new row
  medicationRecords.forEach(record => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${record.cowId}</td>
      <td>${record.medication}</td>
      <td>${record.dosage}</td>
      <td>${record.date}</td>
    `;
    tableBody.appendChild(row);
  });
}

// With localStorage:
function recordMedication() {
  const cowId = document.getElementById('med-cow-id').value;
  const medication = document.getElementById('medication').value;
  const dosage = document.getElementById('dosage').value;

  if (!cowId || !medication || !dosage) {
    alert("Please fill all fields.");
    return;
  }

  const record = {
    cowId: cowId,
    medication: medication,
    dosage: dosage,
    date: new Date().toLocaleDateString()
  };

  let records = JSON.parse(localStorage.getItem('medicationRecords') || '[]');
  records.push(record);
  localStorage.setItem('medicationRecords', JSON.stringify(records));
  
  medicationRecords = records;
  updateMedicationTable();

  document.getElementById('med-cow-id').value = "";
  document.getElementById('medication').value = "";
  document.getElementById('dosage').value = "";

  addNotification(`Medication recorded for Cow ID: ${cowId}`);
}

document.addEventListener('DOMContentLoaded', function() {
  medicationRecords = JSON.parse(localStorage.getItem('medicationRecords') || []);
  updateMedicationTable();
});


function reportHealthConcern() {
  const cowIdValid = validateCowId(document.getElementById('health-cow-id'));
      const concernValid = validateHealthConcern(document.getElementById('health-concern'));
      
      if (!cowIdValid || !concernValid) {
        return;
      }

      const cowId = document.getElementById('health-cow-id').value.trim();
      const concern = document.getElementById('health-concern').value.trim();

  // Create health alert data
  const healthAlert = {
    id: `health-${Date.now()}`, // Unique ID for the alert
    cowId: cowId,
    concern: concern,
    timestamp: new Date().toISOString(),
    status: 'unread', // Mark as unread for the manager
    reportedBy: 'Worker' // Track who reported this
  };

  // Save to localStorage
  saveHealthAlert(healthAlert);

  // Update the worker's UI
  const alertItem = document.createElement('li');
  alertItem.innerHTML = `
    <i class="fas fa-exclamation-triangle"></i>
    <span><strong>Cow ID: ${cowId}</strong> - ${concern}</span>
  `;
  document.getElementById('health-alerts-list').appendChild(alertItem);

  // Clear the form
  document.getElementById('health-cow-id').value = "";
  document.getElementById('health-concern').value = "";

  // Add notification to worker
  addNotification(`Health concern reported for Cow ID: ${cowId}`);
}

function saveHealthAlert(alertData) {
  // Get existing health alerts or initialize empty array
  let healthAlerts = JSON.parse(localStorage.getItem('healthAlerts') || '[]');
  
  // Add new alert
  healthAlerts.push(alertData);
  
  // Save back to localStorage
  localStorage.setItem('healthAlerts', JSON.stringify(healthAlerts));
  
  // Create manager notification
  let managerNotifications = JSON.parse(localStorage.getItem('managerNotifications') || '[]');
  managerNotifications.push({
    id: alertData.id,
    type: 'health-alert',
    title: 'Health Alert',
    message: `Cow ${alertData.cowId}: ${alertData.concern}`,
    timestamp: new Date().toISOString(),
    alertData: alertData,
    status: 'unread'
  });
  localStorage.setItem('managerNotifications', JSON.stringify(managerNotifications));
}
  



function saveHealthAlert(alertData) {
  // Get existing health alerts or initialize empty array
  let healthAlerts = JSON.parse(localStorage.getItem('healthAlerts') || '[]');
  
  // Add new alert with a unique ID
  alertData.id = `health-${Date.now()}`;
  healthAlerts.push(alertData);
  
  // Save back to localStorage
  localStorage.setItem('healthAlerts', JSON.stringify(healthAlerts));
  
  // Create manager notification
  let managerNotifications = JSON.parse(localStorage.getItem('managerNotifications') || '[]');
  managerNotifications.push({
    id: alertData.id,
    type: 'health-alert',
    title: 'Health Alert',
    message: `Cow ${alertData.cowId}: ${alertData.concern}`,
    timestamp: new Date().toISOString(),
    alertData: alertData,
    status: 'unread'
  });
  localStorage.setItem('managerNotifications', JSON.stringify(managerNotifications));
}


    // Inventory & Supplies
    // Update Inventory Progress Bars
function updateInventoryProgress() {
  const fodderCount = parseInt(document.getElementById('fodder-count').textContent);
  const medicineCount = parseInt(document.getElementById('medicine-count').textContent);

  // Update Fodder Progress
  const fodderProgress = document.getElementById('fodder-progress');
  fodderProgress.style.width = `${fodderCount}%`;

  // Update Medicine Progress
  const medicineProgress = document.getElementById('medicine-progress');
  medicineProgress.style.width = `${medicineCount}%`;
}

// Request Refill Function
function requestRefill(item) {
  const count = prompt(`How much ${item} do you need?`);
  if (count) {
    addNotification(`Requested ${item} refill: ${count}`);
    // Update the inventory count (example logic)
    if (item === 'fodder') {
      document.getElementById('fodder-count').textContent = parseInt(document.getElementById('fodder-count').textContent) + parseInt(count);
    } else if (item === 'medicine') {
      document.getElementById('medicine-count').textContent = parseInt(document.getElementById('medicine-count').textContent) + parseInt(count);
    }
    updateInventoryProgress();
  }
}

// Call updateInventoryProgress on page load
document.addEventListener('DOMContentLoaded', function() {
  updateInventoryProgress();
});




// In worker-dashboard.js, update the messaging functions

// Send Message Function
function sendMessage() {
  const subject = document.getElementById('message-subject').value;
  const message = document.getElementById('message').value;
  
  if (!message) {
    alert("Please enter a message.");
    return;
  }

  // Create message data
  const messageData = {
    id: `msg-${Date.now()}`,
    from: 'Worker',
    to: 'Manager',
    subject: subject || 'No subject',
    message: message,
    timestamp: new Date().toISOString(),
    read: false
  };

  // Save to localStorage
  let messages = JSON.parse(localStorage.getItem('workerManagerMessages') || '[]');
  messages.push(messageData);
  localStorage.setItem('workerManagerMessages', JSON.stringify(messages));

  // Add to sent messages
  addSentMessage(messageData);
  showMessages('sent');

  // Clear the form
  document.getElementById('message-subject').value = '';
  document.getElementById('message').value = '';

  // Add notification
  addNotification(`Message sent to manager: ${subject || 'No subject'}`);
}

// Load messages when page loads
document.addEventListener('DOMContentLoaded', function() {
  loadWorkerMessages();
  setInterval(loadWorkerMessages, 5000); // Check for new messages every 5 seconds
});

function loadWorkerMessages() {
  const messages = JSON.parse(localStorage.getItem('workerManagerMessages') || []);
  
  // Filter worker's messages
  const sentMessages = messages.filter(msg => msg.from === 'Worker');
  const receivedMessages = messages.filter(msg => msg.to === 'Worker');
  const unreadCount = receivedMessages.filter(msg => !msg.read).length;

  // Update inbox count
  document.getElementById('inbox-count').textContent = unreadCount;
  if (unreadCount > 0) {
    document.getElementById('inbox-count').style.display = 'inline-block';
  } else {
    document.getElementById('inbox-count').style.display = 'none';
  }

  // Display inbox messages
  const inboxList = document.getElementById('inbox-messages');
  inboxList.innerHTML = '';
  
  if (receivedMessages.length === 0) {
    inboxList.innerHTML = '<div class="empty-message">No messages in inbox</div>';
  } else {
    receivedMessages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    receivedMessages.forEach(msg => {
      const messageItem = document.createElement('div');
      messageItem.className = `message-item ${msg.read ? '' : 'unread'}`;
      messageItem.innerHTML = `
        <div class="message-header">
          <strong>From: ${msg.from}</strong>
          <span>${new Date(msg.timestamp).toLocaleString()}</span>
        </div>
        <div class="message-subject">${msg.subject}</div>
        <div class="message-preview">${msg.message.substring(0, 50)}${msg.message.length > 50 ? '...' : ''}</div>
      `;
      messageItem.addEventListener('click', () => viewFullMessage(msg, 'worker'));
      inboxList.appendChild(messageItem);
    });
  }

  // Display sent messages
  const sentList = document.getElementById('sent-messages');
  sentList.innerHTML = '';
  
  if (sentMessages.length === 0) {
    sentList.innerHTML = '<div class="empty-message">No sent messages</div>';
  } else {
    sentMessages.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
    sentMessages.forEach(msg => {
      const messageItem = document.createElement('div');
      messageItem.className = 'message-item';
      messageItem.innerHTML = `
        <div class="message-header">
          <strong>To: ${msg.to}</strong>
          <span>${new Date(msg.timestamp).toLocaleString()}</span>
        </div>
        <div class="message-subject">${msg.subject}</div>
        <div class="message-preview">${msg.message.substring(0, 50)}${msg.message.length > 50 ? '...' : ''}</div>
      `;
      messageItem.addEventListener('click', () => viewFullMessage(msg, 'worker'));
      sentList.appendChild(messageItem);
    });
  }
}

function showMessages(type) {
  if (type === 'inbox') {
    document.getElementById('inbox-messages').style.display = 'block';
    document.getElementById('sent-messages').style.display = 'none';
    document.querySelector('.inbox-tabs .tab-button:nth-child(1)').classList.add('active');
    document.querySelector('.inbox-tabs .tab-button:nth-child(2)').classList.remove('active');
  } else {
    document.getElementById('inbox-messages').style.display = 'none';
    document.getElementById('sent-messages').style.display = 'block';
    document.querySelector('.inbox-tabs .tab-button:nth-child(1)').classList.remove('active');
    document.querySelector('.inbox-tabs .tab-button:nth-child(2)').classList.add('active');
  }
}

function viewFullMessage(message, userType) {
  // Mark as read if it's an incoming message
  if (userType === 'worker' && message.to === 'Worker') {
    markMessageAsRead(message.id);
  }

  // Create modal to display full message
  const modal = document.createElement('div');
  modal.className = 'message-modal';
  modal.innerHTML = `
    <div class="message-modal-content">
      <span class="close-modal">&times;</span>
      <h3>${message.subject}</h3>
      <div class="message-meta">
        <div><strong>From:</strong> ${message.from}</div>
        <div><strong>To:</strong> ${message.to}</div>
        <div><strong>Date:</strong> ${new Date(message.timestamp).toLocaleString()}</div>
      </div>
      <div class="message-body">
        ${message.message}
      </div>
      ${message.to === 'Manager' ? `
      <button class="btn-reply" onclick="replyToMessage('${message.to}', 'RE: ${message.subject}')">
        <i class="fas fa-reply"></i> Reply
      </button>
      ` : ''}
    </div>
  `;
  
  document.body.appendChild(modal);
  
  // Close modal handlers
  modal.querySelector('.close-modal').addEventListener('click', () => modal.remove());
  modal.addEventListener('click', (e) => {
    if (e.target === modal) modal.remove();
  });
}

function markMessageAsRead(messageId) {
  let messages = JSON.parse(localStorage.getItem('workerManagerMessages') || '[]');
  messages = messages.map(msg => {
    if (msg.id === messageId) {
      return {...msg, read: true};
    }
    return msg;
  });
  localStorage.setItem('workerManagerMessages', JSON.stringify(messages));
  loadWorkerMessages(); // Refresh the message list
}

function replyToMessage(recipient, subject) {
  // Pre-fill the message form
  document.getElementById('message-subject').value = subject;
  document.getElementById('message').focus();
  document.querySelector('.message-modal').remove();
}




// Add sent message to the UI
function addSentMessage(message) {
  const sentList = document.getElementById('sent-messages-list');
  const messageItem = document.createElement('li');
  messageItem.innerHTML = `
    <div class="message-header">
      <strong>${message.subject}</strong>
      <span>${new Date(message.timestamp).toLocaleString()}</span>
    </div>
    <div class="message-content">${message.message}</div>
  `;
  sentList.prepend(messageItem);
}

// Load sent messages when page loads
document.addEventListener('DOMContentLoaded', function() {
  const messages = JSON.parse(localStorage.getItem('workerManagerMessages') || '[]');
  const workerMessages = messages.filter(msg => msg.from === 'Worker');
  
  workerMessages.forEach(message => {
    addSentMessage(message);
  });
});


// Add Notification Function
function addNotification(message) {
  const notificationList = document.getElementById('notification-list');
  const notificationItem = document.createElement('li');
  notificationItem.innerHTML = `
    <i class="fas fa-bell"></i>
    <span>${message}</span>
  `;
  notificationList.appendChild(notificationItem);
}

    // Smooth scrolling for navbar links
    document.querySelectorAll('.navbar-links a').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const targetId = this.getAttribute('href');
        const targetSection = document.querySelector(targetId);

        if (targetSection) {
          targetSection.scrollIntoView({
            behavior: 'smooth',
            block: 'start' // Ensures the section aligns at the top of the viewport
          });
        }
      });
    });

    // Add animation on scroll
    const sections = document.querySelectorAll('.section');
    const options = {
      threshold: 0.1
    };

    const observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('fade-in');
          observer.unobserve(entry.target);
        }
      });
    }, options);

    sections.forEach(section => {
      observer.observe(section);
    });


// Breeding Cycles Data
let breedingRecords = [];

// Initialize Breeding Chart
const breedingCtx = document.getElementById('breedingChart').getContext('2d');
const breedingChart = new Chart(breedingCtx, {
  type: 'line', // Use 'bar' for a bar chart
  data: {
    labels: [], // Dates will be added dynamically
    datasets: [{
      label: 'Breeding Cycles',
      data: [], // Data will be added dynamically
      backgroundColor: 'rgba(51, 95, 60, 0.2)',
      borderColor: '#4B6043',
      borderWidth: 2,
      fill: true,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        title: {
          display: true,
          text: 'Date',
        },
      },
      y: {
        title: {
          display: true,
          text: 'Number of Breeding Cycles',
        },
        beginAtZero: true,
      },
    },
  },
});

// Record Breeding Cycle
function recordBreedingCycle() {
  const cowId = document.getElementById('cow-id-breeding').value;
  const breedingDate = document.getElementById('breeding-date').value;
  const expectedCalvingDate = document.getElementById('expected-calving-date').value;

  if (!cowId || !breedingDate || !expectedCalvingDate) {
    alert("Please fill all fields.");
    return;
  }

  const record = {
    cowId: cowId,
    breedingDate: breedingDate,
    expectedCalvingDate: expectedCalvingDate,
  };
  breedingRecords.push(record);
  updateBreedingChart();
  addNotification(`Breeding cycle recorded for Cow ID: ${cowId}`);
  document.getElementById('cow-id-breeding').value = "";
  document.getElementById('breeding-date').value = "";
  document.getElementById('expected-calving-date').value = "";
}

// Update Breeding Chart
function updateBreedingChart() {
  const labels = breedingRecords.map(record => record.breedingDate);
  const data = breedingRecords.map((record, index) => index + 1); // Incrementing count

  breedingChart.data.labels = labels;
  breedingChart.data.datasets[0].data = data;
  breedingChart.update();
}


// Initialize Abnormal Milk Production Chart
const abnormalMilkCtx = document.getElementById('abnormalMilkChart').getContext('2d');
const abnormalMilkChart = new Chart(abnormalMilkCtx, {
  type: 'line',
  data: {
    labels: [], // Dates will be added dynamically
    datasets: [{
      label: 'Milk Production (Liters)',
      data: [], // Milk production data will be added dynamically
      backgroundColor: 'rgba(75, 192, 192, 0.2)',
      borderColor: '#4B6043',
      borderWidth: 2,
      fill: true,
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: {
        title: {
          display: true,
          text: 'Date',
        },
      },
      y: {
        title: {
          display: true,
          text: 'Milk Production (Liters)',
        },
        beginAtZero: true,
      },
    },
  },
});









// Logout Confirmation
function confirmLogout() {
  const confirmLogout = confirm("Are you sure you want to logout?");
  if (confirmLogout) {
    window.location.href = "index.html"; // Redirect to index.html
  }
}



// Scroll to Top Button Functionality
const scrollToTopBtn = document.getElementById("scrollToTopBtn");

// Show the button when the user scrolls down 200px
window.addEventListener("scroll", () => {
  if (window.scrollY > 200) {
    scrollToTopBtn.classList.add("show");
  } else {
    scrollToTopBtn.classList.remove("show");
  }
});

// Scroll to the top of the page when the button is clicked
scrollToTopBtn.addEventListener("click", () => {
  window.scrollTo({
    top: 0,
    behavior: "smooth", // Smooth scroll
  });
});

// Fodder Refill Modal Functions
function openFodderModal() {
  document.getElementById('fodder-refill-modal').style.display = 'block';
}

function closeFodderModal() {
  document.getElementById('fodder-refill-modal').style.display = 'none';
}

function showSuccessPopup() {
  document.getElementById('fodder-success-popup').style.display = 'flex';
}

function closeSuccessPopup() {
  document.getElementById('fodder-success-popup').style.display = 'none';
  closeFodderModal();
}

// Handle form submission
document.getElementById('fodder-refill-form').addEventListener('submit', function(e) {
  e.preventDefault();
  
  const fodderType = document.getElementById('fodder-type').value;
  const quantity = document.getElementById('fodder-quantity').value;
  const urgency = document.getElementById('fodder-urgency').value;
  const notes = document.getElementById('fodder-notes').value;
  
  // Create request data
  const requestData = {
    type: 'fodder',
    fodderType: fodderType,
    quantity: quantity,
    urgency: urgency,
    notes: notes,
    timestamp: new Date().toISOString(),
    status: 'pending'
  };

  // Save to localStorage (or send to API in real app)
  saveFodderRequest(requestData);
  
  // Show success popup
  showSuccessPopup();
  
  // Add notification
  addNotification(`Fodder refill requested: ${quantity}kg of ${fodderType} (${urgency} priority)`);
  
  // Reset form
  this.reset();
});

// In the worker-dashboard.html script section

function saveFodderRequest(requestData) {
    // Get existing requests or initialize empty array
    let requests = JSON.parse(localStorage.getItem('fodderRequests') || '[]');
    
    // Add new request
    requests.push(requestData);
    
    // Save back to localStorage
    localStorage.setItem('fodderRequests', JSON.stringify(requests));
    
    // Create manager notification
    let managerNotifications = JSON.parse(localStorage.getItem('managerNotifications') || '[]');
    managerNotifications.push({
        id: `fodder-${Date.now()}`,
        type: 'fodder-request',
        title: 'Fodder Refill Request',
        message: `Worker requested ${requestData.quantity}kg of ${requestData.fodderType} (${requestData.urgency} priority)`,
        timestamp: new Date().toISOString(),
        requestData: requestData,
        status: 'unread'
    });
    localStorage.setItem('managerNotifications', JSON.stringify(managerNotifications));
}

function loadWorkerTasks() {
    const tasks = JSON.parse(localStorage.getItem('tasks') || []);
    const workerTasks = tasks.filter(task => 
        task.assigned_to === 'all' || 
        task.assigned_to === 'worker' || 
        task.assigned_to === 'worker1' || 
        task.assigned_to === 'worker2' // Add all worker IDs here
    );
    
    // Reset task status counts
    taskStatus = {
        assigned: 0,
        pending: 0,
        completed: 0,
        notDone: 0
    };
    
    // Count tasks by status
    workerTasks.forEach(task => {
        if (task.status === 'assigned') {
            taskStatus.assigned++;
        } else if (task.status === 'pending') {
            taskStatus.pending++;
        } else if (task.status === 'completed') {
            taskStatus.completed++;
        } else if (task.status === 'notDone') {
            taskStatus.notDone++;
        }
    });
    
    // Update the chart with current counts
    updateChart();
    
    const taskList = document.getElementById('task-list');
    taskList.innerHTML = '';
    
    if (workerTasks.length === 0) {
        taskList.innerHTML = '<li>No tasks assigned</li>';
        return;
    }
    
    workerTasks.forEach(task => {
        const taskItem = document.createElement('li');
        
        // Format due date
        let dueDateText = '';
        if (task.due_date) {
            const dueDate = new Date(task.due_date);
            dueDateText = ` (Due: ${dueDate.toLocaleDateString()})`;
        }
        
        // Determine badge color based on status
        let badgeClass = '';
        let badgeText = '';
        if (task.status === 'assigned') {
            badgeClass = 'status-badge assigned';
            badgeText = 'Assigned';
        } else if (task.status === 'pending') {
            badgeClass = 'status-badge pending';
            badgeText = 'In Progress';
        } else if (task.status === 'completed') {
            badgeClass = 'status-badge completed';
            badgeText = 'Completed';
        } else if (task.status === 'notDone') {
            badgeClass = 'status-badge not-done';
            badgeText = 'Not Done';
        }
        
        taskItem.innerHTML = `
            <div class="task-header">
                <span class="task-title">${task.title}${dueDateText}</span>
                <span class="${badgeClass}">${badgeText}</span>
            </div>
            <div class="task-description">${task.description || ''}</div>
            <div class="task-buttons">
                ${task.status !== 'completed' && task.status !== 'notDone' ? `
                <button class="btn-in-progress" onclick="updateTaskStatus(this, '${task.id}', 'pending')">
                    <i class="fas fa-play"></i> In Progress
                </button>
                <button class="btn-complete" onclick="updateTaskStatus(this, '${task.id}', 'completed')">
                    <i class="fas fa-check"></i> Complete
                </button>
                <button class="btn-not-done" onclick="updateTaskStatus(this, '${task.id}', 'notDone')">
                    <i class="fas fa-times"></i> Not Done
                </button>
                ` : ''}
                ${task.status === 'completed' ? `
                <span class="task-completed-text"><i class="fas fa-check-circle"></i> Task completed</span>
                ` : ''}
                ${task.status === 'notDone' ? `
                <span class="task-not-done-text"><i class="fas fa-times-circle"></i> Task not done</span>
                ` : ''}
            </div>
        `;
        
        taskList.appendChild(taskItem);
    });
}

// Update task status from worker dashboard
function updateTaskStatus(button, taskId, newStatus) {
    let tasks = JSON.parse(localStorage.getItem('tasks') || []);
    const taskIndex = tasks.findIndex(t => t.id === taskId);
    
    if (taskIndex !== -1) {
        // Get the current status to decrement that count
        const currentStatus = tasks[taskIndex].status;
        
        // Update the task status
        tasks[taskIndex].status = newStatus;
        tasks[taskIndex].last_updated = new Date().toISOString();
        localStorage.setItem('tasks', JSON.stringify(tasks));
        
        // Update the taskStatus counts
        if (currentStatus === 'assigned') {
            taskStatus.assigned--;
        } else if (currentStatus === 'pending') {
            taskStatus.pending--;
        } else if (currentStatus === 'completed') {
            taskStatus.completed--;
        } else if (currentStatus === 'notDone') {
            taskStatus.notDone--;
        }
        
        // Increment the new status count
        if (newStatus === 'pending') {
            taskStatus.pending++;
        } else if (newStatus === 'completed') {
            taskStatus.completed++;
        } else if (newStatus === 'notDone') {
            taskStatus.notDone++;
        } else if (newStatus === 'assigned') {
            taskStatus.assigned++;
        }
        
        // Update the chart with new data
        updateChart();
        
        // Add appropriate notification
        if (newStatus === 'completed') {
            addNotification(`Task completed: ${tasks[taskIndex].title}`);
        } else if (newStatus === 'notDone') {
            addNotification(`Marked as not done: ${tasks[taskIndex].title}`);
        } else if (newStatus === 'pending') {
            addNotification(`Task in progress: ${tasks[taskIndex].title}`);
        }
        
        // Reload tasks to update the UI
        loadWorkerTasks();
        
        // Create manager notification if task is completed or marked as not done
        if (newStatus === 'completed' || newStatus === 'notDone') {
            let managerNotifications = JSON.parse(localStorage.getItem('managerNotifications') || '[]');
            managerNotifications.push({
                id: `task-${Date.now()}`,
                type: 'task-update',
                title: 'Task Update',
                message: `Task "${tasks[taskIndex].title}" was marked as ${newStatus} by worker`,
                timestamp: new Date().toISOString(),
                taskData: tasks[taskIndex],
                status: 'unread'
            });
            localStorage.setItem('managerNotifications', JSON.stringify(managerNotifications));
        }
    }
}

// Update task status from worker dashboard
function updateTaskStatus(button, taskId, newStatus) {
    let tasks = JSON.parse(localStorage.getItem('tasks') || []);
    const taskIndex = tasks.findIndex(t => t.id === taskId);
    
    if (taskIndex !== -1) {
        // Get the current status to decrement that count
        const currentStatus = tasks[taskIndex].status;
        
        // Update the task status
        tasks[taskIndex].status = newStatus;
        localStorage.setItem('tasks', JSON.stringify(tasks));
        
        // Update the taskStatus counts
        if (currentStatus === 'assigned') {
            taskStatus.assigned--;
        } else if (currentStatus === 'pending') {
            taskStatus.pending--;
        } else if (currentStatus === 'completed') {
            taskStatus.completed--;
        } else if (currentStatus === 'notDone') {
            taskStatus.notDone--;
        }
        
        // Increment the new status count
        if (newStatus === 'pending') {
            taskStatus.pending++;
        } else if (newStatus === 'completed') {
            taskStatus.completed++;
        } else if (newStatus === 'notDone') {
            taskStatus.notDone++;
        }
        
        // Update the chart with new data
        updateChart();
        
        // Update UI
        const taskItem = button.parentElement;
        if (newStatus === 'pending') {
            button.innerHTML = '<i class="fas fa-check"></i> Mark as Completed';
            button.setAttribute('onclick', `updateTaskStatus(this, '${taskId}', 'completed')`);
        } else if (newStatus === 'completed') {
            taskItem.remove();
            addNotification(`Task completed: ${tasks[taskIndex].title}`);
        }
    }
}


// Load tasks when page loads and set interval to check for new tasks
document.addEventListener('DOMContentLoaded', function() {
    loadWorkerTasks();
    setInterval(loadWorkerTasks, 5000); // Check for new tasks every 5 seconds
});





// ---------------------------------------------- validation functions
 // Validation Functions
 function validateCowId(input) {
      const errorId = input.id + '-error';
      const errorElement = document.getElementById(errorId);
      const value = input.value.trim();
      
      if (!/^\d+$/.test(value)) {
        input.classList.add('input-error');
        errorElement.style.display = 'block';
        return false;
      } else {
        input.classList.remove('input-error');
        errorElement.style.display = 'none';
        return true;
      }
    }

    function validateMilkProduction(input) {
      const errorElement = document.getElementById('milk-production-error');
      const value = input.value.trim();
      
      if (!/^\d*\.?\d+$/.test(value)) {
        input.classList.add('input-error');
        errorElement.style.display = 'block';
        return false;
      } else {
        input.classList.remove('input-error');
        errorElement.style.display = 'none';
        return true;
      }
    }

    function validateFeedAmount(input) {
      const errorElement = document.getElementById('feed-amount-error');
      const value = input.value.trim();
      
      if (!/^\d*\.?\d+$/.test(value)) {
        input.classList.add('input-error');
        errorElement.style.display = 'block';
        return false;
      } else {
        input.classList.remove('input-error');
        errorElement.style.display = 'none';
        return true;
      }
    }

    function validateMedication(input) {
      const errorElement = document.getElementById('medication-error');
      const value = input.value.trim();
      
      if (/[^a-zA-Z0-9\s]/.test(value)) {
        input.classList.add('input-error');
        errorElement.style.display = 'block';
        return false;
      } else {
        input.classList.remove('input-error');
        errorElement.style.display = 'none';
        return true;
      }
    }

    function validateDosage(input) {
      const errorElement = document.getElementById('dosage-error');
      const value = input.value.trim();
      
      if (!/^\d+\s*[a-zA-Z]+$/.test(value)) {
        input.classList.add('input-error');
        errorElement.style.display = 'block';
        return false;
      } else {
        input.classList.remove('input-error');
        errorElement.style.display = 'none';
        return true;
      }
    }

    function validateHealthConcern(input) {
      const errorElement = document.getElementById('health-concern-error');
      const value = input.value.trim();
      
      if (/[^a-zA-Z0-9\s.,]/.test(value)) {
        input.classList.add('input-error');
        errorElement.style.display = 'block';
        return false;
      } else {
        input.classList.remove('input-error');
        errorElement.style.display = 'none';
        return true;
      }
    }


  </script>
</body>
</html>