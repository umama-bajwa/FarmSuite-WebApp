<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cart</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="shopkeeper-dashboard.css">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-brand">
      <i class="fas fa-store"></i>
      <span>Shopkeeper Dashboard</span>
    </div>
    <div class="navbar-links">
      <a href="shopkeeper-dashboard.html"><i class="fas fa-box-open"></i> Products</a>
      <a href="shopkeeper-cart.html"><i class="fas fa-shopping-cart"></i> Cart (<span id="cart-count">0</span>)</a>
      <a href="shopkeeper-payments.html"><i class="fas fa-credit-card"></i> Payments</a>
      <a href="shopkeeper-invoices.html"><i class="fas fa-file-invoice"></i> Invoices</a>
      <a href="#" onclick="confirmLogout()" class="logout-button">
        <i class="fas fa-sign-out-alt"></i> Logout
      </a>
    </div>
  </nav>

  <!-- Cart Section -->
  <div class="dashboard">
    <section id="cart" class="section">
      <h2><i class="fas fa-shopping-cart"></i> Shopping Cart</h2>
      <div class="card">
        <div class="cart-container">
          <div id="cart-items">
            <!-- Cart items will be dynamically added here -->
          </div>
          <div class="cart-summary">
            <h3>Cart Summary</h3>
            <p>Total Items: <span id="total-items">0</span></p>
            <p>Total Price: PKR <span id="total-price">0.00</span></p>
            <button onclick="proceedToPayment()"><i class="fas fa-credit-card"></i> Proceed to Payment</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Payment Alert Popup (new) -->
  <div class="payment-alert-overlay" id="paymentAlert">
    <div class="payment-alert-popup">
      <div class="payment-alert-icon">
        <i class="fas fa-exclamation-circle"></i>
      </div>
      <h3 class="payment-alert-title">Empty Cart</h3>
      <p class="payment-alert-message">Your cart is empty! Please add some items before proceeding to payment.</p>
      <button class="payment-alert-button" onclick="hidePaymentAlert()">OK</button>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    let cart = [];

    // Load cart from localStorage
    window.addEventListener("load", () => {
      const savedCart = localStorage.getItem("cart");
      if (savedCart) {
        cart = JSON.parse(savedCart);
      } else {
        // Sample data for testing (remove in production)
        cart = [
          {
            productName: "Sample Product 1",
            price: 19.99,
            image: "https://via.placeholder.com/150",
            quantity: 1
          },
          {
            productName: "Sample Product 2",
            price: 29.99,
            image: "https://via.placeholder.com/150",
            quantity: 1
          }
        ];
        localStorage.setItem("cart", JSON.stringify(cart));
      }
      updateCartUI();
    });

    // Single updateCartUI function with quantity controls
    function updateCartUI() {
      const cartItems = document.getElementById("cart-items");
      const cartCount = document.getElementById("cart-count");
      const totalItems = document.getElementById("total-items");
      const totalPrice = document.getElementById("total-price");

      // Clear existing items
      cartItems.innerHTML = "";

      if (cart.length === 0) {
        cartItems.innerHTML = `
          <div class="empty-cart-popup">
            <div class="empty-cart-icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <h3>Your Shopping Cart is Empty</h3>
            <p>Looks like you haven't added any items to your cart yet.</p>
            <button class="empty-cart-button" onclick="window.location.href='shopkeeper-dashboard.html'">
              <i class="fas fa-arrow-left"></i> Continue Shopping
            </button>
          </div>
        `;
        cartCount.textContent = "0";
        totalItems.textContent = "0";
        totalPrice.textContent = "0.00";
        return;
      }

      // Add new items with quantity controls
      cart.forEach((item, index) => {
        const cartItem = document.createElement("div");
        cartItem.className = "cart-item";
        cartItem.innerHTML = `
          <div style="flex: 1;">
            <div style="font-weight: 600;">${item.productName}</div>
            <div>PKR ${item.price.toFixed(2)}</div>
          </div>
          <div class="quantity-controls">
            <button class="quantity-btn" onclick="updateQuantity(${index}, -1)">-</button>
            <span class="quantity-value">${item.quantity || 1}</span>
            <button class="quantity-btn" onclick="updateQuantity(${index}, 1)">+</button>
          </div>
          <button onclick="removeFromCart(${index})"><i class="fas fa-trash"></i> Remove</button>
        `;
        cartItems.appendChild(cartItem);
      });

      // Update totals
      const itemCount = cart.reduce((sum, item) => sum + (item.quantity || 1), 0);
      const priceTotal = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);
      
      cartCount.textContent = cart.length;
      totalItems.textContent = itemCount;
      totalPrice.textContent = priceTotal.toFixed(2);
    }

    // Update quantity function
    function updateQuantity(index, change) {
      if (!cart[index].quantity) {
        cart[index].quantity = 1;
      }
      
      cart[index].quantity += change;
      
      // Ensure quantity doesn't go below 1
      if (cart[index].quantity < 1) {
        cart[index].quantity = 1;
      }
      
      updateCartUI();
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    // Remove from Cart
    function removeFromCart(index) {
      cart.splice(index, 1);
      updateCartUI();
      localStorage.setItem("cart", JSON.stringify(cart));
    }

    // Proceed to Payment
  // In shopkeeper-cart.html
  function proceedToPayment() {
      if (cart.length === 0) {
        showPaymentAlert();
        return;
      }

  // Save cart items to localStorage
  localStorage.setItem("checkoutCart", JSON.stringify(cart));
  
  // Calculate total amount considering quantities
  const totalAmount = cart.reduce((sum, item) => sum + (item.price * (item.quantity || 1)), 0);

  // Generate invoice details
  const invoiceDetails = {
    invoiceNumber: "INT-" + Math.floor(1000 + Math.random() * 9000),
    invoiceDate: new Date().toLocaleDateString("en-GB"),
    poNumber: "PO-" + Math.floor(1000 + Math.random() * 9000),
    dueDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toLocaleDateString("en-GB"),
    totalAmount: totalAmount.toFixed(2)
  };

  // Save invoice details to localStorage
  localStorage.setItem("invoiceDetails", JSON.stringify(invoiceDetails));

  // Redirect to payments page
  window.location.href = "shopkeeper-payments.html";
}





    // Logout Confirmation
    function confirmLogout() {
      const confirmLogout = confirm("Are you sure you want to logout?");
      if (confirmLogout) {
        window.location.href = "index.html";
      }
    }

    // Show payment alert popup
    function showPaymentAlert() {
      const paymentAlert = document.getElementById('paymentAlert');
      paymentAlert.classList.add('active');
    }

    // Hide payment alert popup
    function hidePaymentAlert() {
      const paymentAlert = document.getElementById('paymentAlert');
      paymentAlert.classList.remove('active');
    }

  </script>
</body>
</html>